
#include "libraw_wrapper.h"

int bin2()
{

    uint16_t in[] = 
    {
        70,   406,  2166,  5538,  7826,  6531,  8145,  5650,  6688,  1999,  6598,  7957,     0, 
        5401,  1589,  3748,  1847,  8269,  1480,   649,  7627,  1505,  8367,  2206,  4331,     0, 
        9820,  4397,  3543,  2955,  7134,  9308,  2612,  7985,  2504,  5324,  7831,  2074,     0, 
        3296,  2005,  8356,  4112,  5353,  6945,  5459,  2667,  5245,  6957,  5727,  5451,     0, 
        5778,  7218,  2033,   630,  5449,   204,  5512,  8092,   647,  7984,   705,  9786,     0, 
        5779,  3289,  5639,  3598,  2973,  9406,  8460,  3143,  8914,  1389,   229,  3525,     0, 
        338,  2753,  1229,   227,  3168,  8076,  2770,  3964,  5270,  5312,  4257,  7199,     0, 
        3708,  2911,  5924,  5745,   147,  7759,  9448,  4595,  6600,  7462,   744,  3891,     0, 
    };
    uint16_t out[] = 
    {
        3900,  3324,  6429,  7369,  5905,  4339, 
        5200,  2388,  4933,  4680,  3671,  6277, 
        2345,  2707,  4225,  5084,  2720,  7570, 
        5263,  3886,  5257,  6226,  4122,  4067, 
    };
    
    cv::Mat a(8,13,CV_16UC1,in);
    cv::Mat aact = a(cv::Rect(0,0,12,8));
    cv::Mat b = ols::apply_bin2(a);
    if(memcmp(b.data,out,sizeof(out)) == 0) {
        printf("Ok\n");
        return 0;
    }
    else {
        uint16_t *res = (uint16_t*)(b.data);
        for(unsigned i=0;i<sizeof(out)/2;i++) {
            printf("%4d: %5d %5d %c\n",i,res[i],out[i],(res[i]==out[i] ? ' ' : '!'));
        }
        printf("Fail\n");
        return 1;
    }


}

int bin3()
{

    uint16_t in[] = 
    {
        271,  2807,  9727,  5461,  3275,  9757,  6100,  6397,   687,  6628,  6516,  6677,   359,  9182,  9645,  2232,   543,  1917,     0, 
        3109,  5972,  2910,  9555,  2933,  5745,  2184,  8913,  5959,  3511,  7128,  1437,  4897,  6975,  5470,     8,  5772,  2021,     0, 
        2455,  7452,  9477,  7191,  7605,  4731,  6923,   780,  3905,  4210,  6030,  8055,  3487,   712,  3851,  7133,  3952,  7711,     0, 
        1285,  1945,  3634,  5795,  3914,     8,  2711,  5760,   363,  7199,  5809,  9415,  2516,  4085,  8760,  5184,  4851,  1504,     0, 
        8281,  9720,  2737,  9016,  2206,  5123,  4042,  4889,  9090,  6153,   113,  1928,   274,  2787,  5226,  5937,  4963,  8823,     0, 
        4523,  7649,  2112,  2227,  6954,   143,  2356,  6934,  8789,  6973,  4853,  9804,  9814,  1284,  3729,  3144,  6654,   556,     0, 
        956,  2270,  5920,  8173,  3563,   297,  9196,  9757,  5256,  1951,  9472,  1649,  7557,  2646,  3538,   254,  7659,  4119,     0, 
        5577,  4988,  1985,  3510,  1249,  4761,  1971,   199,  5255,  4191,  6831,  6620,  8863,  3228,  4476,  1867,  5421,  5945,     0, 
        4325,  6494,  3576,  7903,  9398,   283,  3196,  5427,   941,  1218,  3678,   105,   261,  3888,  6576,  8029,  7352,  1786,     0, 
        356,  6664,  5108,  5854,  5819,  6257,  4783,  1316,  2605,  3546,   596,  1897,  5507,  8927,  7426,  5074,  2639,  2550,     0, 
        5510,  4036,  3539,  6611,  8681,  2870,  4051,  1792,  6854,  1298,  5898,  4584,  8946,    36,  1425,  4125,  9758,   172,     0, 
        9070,  3224,   890,  7502,   307,  6209,  4913,  9527,  4306,  8157,  1703,  9150,  9447,  1599,  9614,  2313,   486,   375,     0, 
    };

    uint16_t out[] = 
    {
        5115,  6806,  4823,  5080,  3589,  5159, 
        3486,  4338,  4461,  6661,  5829,  2751, 
        5052,  4326,  5394,  3087,  5897,  2784, 
        3373,  5441,  3663,  4956,  5987,  3542, 
    };


    cv::Mat a(12,19,CV_16UC1,in);
    cv::Mat aact = a(cv::Rect(0,0,18,12));
    cv::Mat b = ols::apply_bin3(a);
    if(memcmp(b.data,out,sizeof(out)) == 0) {
        printf("Ok\n");
        return 0;
    }
    else {
        uint16_t *res = (uint16_t*)(b.data);
        for(unsigned i=0;i<sizeof(out)/2;i++) {
            printf("%4d: %5d %5d %c\n",i,res[i],out[i],(res[i]==out[i] ? ' ' : '!'));
        }
        printf("Fail\n");
        return 1;
    }
}

int main()
{
    printf("Testing 2\n");
    if(bin2()!=0)
        return 1;

    printf("Testing 3\n");
    if(bin3()!=0)
        return 1;
    return 0;
}

